Implements the IP Prespecified Timestamp dealias method described in
"Resolving IP Aliases with Prespecified Timestamps", Sherry et al., IMC'10

Usage
-----

usage: ./mper-tsps-dealias-dev [-?fv] [-n concurrency] [-s spacing] [-l logfile]
                               [-P probe-method] -p mperport 
                               -c candidates | -b suit-results | IPa IPb
    -p, --mper-port=NUM              mper control socket port (REQUIRED)
    -c, --candidates=PATH            file with candidate pair information
    -b, --suitability-results=PATH   file with results of suitability checking
    -n, --concurrency=NUM            max pairs to dealias concurrently (default: unlimited)
    -s, --spacing=NUM                spacing (ms) between probes (default: 0)
    -f, --full                       show full result output
    -v, --[no-]verbose               show detailed progress
    -l, --log=PATH                   mper command/result message log path
    -P, --probe-method=METHOD        the probing method to use - icmp (default) or udp
    -?, --help                       show this message

The tool has three probing modes; full-dealiasing, suitability checking and
educated-dealiasing.

The most common, and simple, is full dealiasing, where a pair (or multiple
pairs) of candidate addresses are provided and the tool attempts to determine if
they are aliases.

The other modes split the algorithm into two pieces; the first of which is
referred to as "Suitability Checking". Suitability checking only requires one
address and it attempts to determine if the address is a viable candidate for
dealiasing using prespecified timestamps. Once an address has been run through
the suitability checking logic, it is classified as INELIGIBLE (meaning that it
cannot be used at all for dealiasing), or as one of three pass types (two, three
or four stamps). These results can be used with some additional heuristics to
help determine which pairs should be probed with the remainder of the dealiasing
algorithm using the "Educated Dealiasing" mode. 

The educated dealiasing mode takes post-processed suitability results and uses
them to bypass some of the initial probing usually needed when naively
dealiasing a pair of addresses. To make use of this, the suitability results for
the desired candidate pair should be combined into the standard output format
(as described below) and passed to the tool using the --suitability-results
option. This will force the tool to use the given suitability results and move
directly to the alias validity check. Note that care should be taken when doing
this as the stamping behavior may change over time so the two steps should be
done as close together as possible.

There are two ways to provide candidate addresses to the tool; explicitly on the
command line, or in a candidate list file.

If providing pairs, the tool accepts two formats; space separated and comma
separated. For example, "130.217.250.13 130.217.250.15" or
"130.217.250.13,130.217.250.15".

If these are given in a candidate file, there must be one pair per line. If a
single address is given per line, the tool will perform only the suitability
check as described above.

The tool can also accept space separated and comma separated pairs on the
command line, but if space separated pairs are given, the tool will generate
candidate pairs by moving left to right. For example, "A B C D" will create two
pairs, "A,B C,D". As with the candidate file, if only one address is given it
will be used as a suitability-only candidate. There is a subtle difference here
when compared to the candidate file; if an odd number of space-separated
addresses are given, the last address will only have the suitability check run
as the tool cannot determine which address to pair it with. 

Output Format
-------------

In the normal mode, there is one line of output for each pair of candidate 
addresses (IPa,IPb), as follows:
<candidate_pair>|<suitability_check>|<alias_validity_check|<reverse_path> \
  <alias_check>|<shared_clk>|<distance_loop>|<overall>

The structure and possible values in each section are listed below:

<candidate_pair> MANDATORY
  IPa,IPb
  e.g. 192.168.1.1,192.168.1.2

<suitability_check> MANDATORY
  <result>,<result>
  The suitability check is performed on each address.
  
  The possible result values are:
    P4Sx => Pass, 4 Stamps
    P3Sx => Pass, 3 Stamps
    P2Sx => Pass, 2 Stamps
    F1Sx => Fail, One Stamp
    FNSx => Fail, No Stamp
    FNRx => Fail, No Reply
    FESx => Fail, Extra Stamp
    FVSx => Fail, Varying Stamps (multiple stamping behaviours were observed)
     (where x is the number of probes that were replied to)

<alias_validity_check> OPTIONAL
  <result>,<result>
  The alias validity check is only performed if both IPa and IPb pass the 
  suitability check.

  Possible values are:
    P2S  => Pass, Two Stamps
    P3S  => Pass, Three Stamps (weeded out in alias check)
    P4S  => Pass, Four Stamps
    FNR  => Fail, No Reply 
    F1S  => Fail, One Stamp
    FN   => Fail, No Stamps
    FVS  => Fail, Varying Stamps (multiple stamping behaviours were 
                                     observed)
    FRD  => Fail, Reverse path Decrement (interface is on the reverse path,
                                          timestamps decremented)
    FRG  => Fail, Reverse path Gap (interface is on the reverse path,
                                    gap between timestamps)
    FRU  => Fail, Reverse path Unknown (interface *probably* on the reverse 
                                        path, inconclusive timestamps)

<reverse_path> OPTIONAL
  The reverse path check is only performed if 
  (IPa==P2S && IPb==F1S) || (IPa==F1S && IPb==P2S)
  Works by probing the P2S interface (A) with (A|BABA) to determine if B
  is in fact in the return path from A.

  Possible values are:
    FNR     => Fail, No Reply
    FVS     => Fail, Varying Stamps
    FNS     => Not enough data to make a conclusion (UNKNOWN-NOALIAS)
    F1S     => Should not happen (load balancing?) (ERROR)
    F2[DGU] => A is in the fwd path, but not reverse? (see FR* above)
    F3[DGU] => A is in both fwd and reverse path (see FR* above)
    F4S     => Should not happen (ERROR)

<alias_check> OPTIONAL
  The alias check is only performed if both IPa and IPb pass the 
  validity check

  Possible values are:
    P2S => Pass, Two Stamps
    P4S => Pass, Four Stamps (indicates an alias)
    F3S => Fail, Three Stamps (an error condition)
    FIR => Fail, Insufficient Stamps (50% total replies are required)

<shared_clk> OPTIONAL
  The shared clock test is only performed if the alias check test is
  passed with the PTS flag, indicating that the replies were stamped
  twice.

  Possible values are:
    PSC  => Pass, Shared Clock
    PME  => Pass, Midnight/Epoch
    FDT  => Fail, Decreasing Timestamp
    F90  => Fail, less than 90% stamp consistency

<distance_loop> OPTIONAL
  The distance test is only preformed if the shared clock test is
  passed with the PSC flag.

  Possible values are:
    PDI  => Pass, Distance
    FNRx => Fail, No Reply (where x is the number of noreplies)
    FTV  => Fail, TTL Variance (within the probes to a single interface)

<overall> MANDATORY
  The overall value is the end result of performing the dealias algorithm
  on the candidate pair.

  Possible values are:
    ALIAS            => Confirmed as aliases.
    ALIAS-WEAK       => Confirmed as aliases using the weak distance check
    ALIAS-STRONG     => Confirmed as aliases using the distance check also.
    NOALIAS-WEAK     => Low-confidence non-aliases
    NOALIAS-STRONG   => High-confidence non-aliases
    UNKNOWN          => A determination could not be made.
    UNKNOWN-REPROBE  => Could potentially be resolved by reprobing.
    UNKNOWN-ALIAS    => Are probably aliases but cannot be confirmed.
    UNKNOWN-NOALIAS  => Are probably not aliases but cannot be confirmed
    INELIGIBLE => The candidate interfaces were not suitable for this
                  technique.
    ERROR      => An unexpected result not handled by the algorithm.

If the --full mode is specified, additional lines will be output by the tool 
showing the full details for each probe response that is received.
The format of these lines is as follows:

"< <candidates>|<desitnation>|<type>|<timestamps>|<reply_ttl>|<rtt>"

Note that the leading '<' is an explicit character to indicate this was a reply
received by the tool (in keeping with the convention used by mper-ping).

<candidates> MANDATORY
  These are an A,B pair which indicates the two addresses that were used in the
  probe. Note that these do not necessarily match the A and B of the candidate
  pair.

<destination>|<type> MANDATORY
  Indicates which (A or B) address the probe was targeted to, and also the
  format of the prespecified addresses loaded into the timestamp option.

  e.g. for the dealiasing, this could be A|ABAB

<timestamps> MANDATORY
  Gives the stamps that were in the response to the probe. All interfaces and
  stamps up to the pointer in the option are listed. If mper is able to detect a
  change in the options included in the reply (for example if options are
  stripped from the packet), then it will append "ALTERED" to the list of
  timestamps.

  The format for these stamps are as follows:
  <TS IP 1>=<TS STAMP 1>,<TS IP 2>=<TS STAMP 2>,<TS IP 3>=<TS STAMP 3>,
      <TS IP 4>=<TS STAMP 4>[,ALTERED]

<reply_ttl>
  Gives the ttl of the response packet

<rtt>
  Gives the round trip time for the probe


Differences from the original algorithm
---------------------------------------

The dealiasing process and classification implemented in this tool differs
slightly from the original algorithm described by Sherry et al.. 

As outlined in the above OUTPUT FORMAT section, we provide a total of 11 overall
outcomes from dealising whereas the original algorithm only describes three
(alias, non-alias and unknown). These come as a result of investigating the
causes of the various behaviors, and so we can give more specific
results.
We split the alias category into ALIAS, ALIAS-WEAK and ALIAS-STRONG. As the
names indicate, these are are all aliases, but the tool has been able to give
some indication of the confidence of the classification. Similar sub-categories
are used for NOALIAS also.
The UNKNOWN category is split into UNKNOWN, UNKNOWN-REPROBE, UNKNOWN-ALIAS,
UNKNWON-NOALIAS. UNKNOWN indicates that the tool is not able to make any
determination of the pair of addresses. UNKNOWN-REPROBE indicates that the
results of probing are possibly transient and simply re-running the tool *may*
allow a determination to be made. UNKNOWN-ALIAS indicates that the tool is not
able to make a determination whether the addresses are aliases, but it suspects
that they may be. Similarly, UNKNWON-NOALIAS indicates a inability to classify
the addresses, but they may not be aliases.

There are also additional heuristics we have developed to detect cases where the
addresses appear to be aliases, but one is actually on the reverse path from the
other. These are the only cases where we declare non-aliases.

In the original description of the algorithm, the reverse path distance check
was performed only when one address returned two stamps to (A|ABAB) and the
other returned one stamp. We perform this check even when both addresses return
two stamps to give an even stronger alias result. A failure of the test will not
result in a non-alias being declared (the overall result will be ALIAS), but a
pass will result in an overall classification of ALIAS-STRONG.

Overall Statistics
------------------

A script to carry out some basic overall analysis of a dealiasing run is
included in this release.

The script takes the mper-tsps-dealias results output and generates statistics
for each of the sub-components that are described in the "Output Format" section
above.

The abbreviated codes given in the "Output Format" section are expanded as
follows:

Raw Code	Stats Label
------------------------------
FNR 		Unresponsive
FVS		Inconsistent
FES		Extra Stamp
FNS		Zero Stamps
F1S		One Stamp
P2S		Two Stamps
P3S		Three Stamps
P4S		Four Stamps

FR[DGU]		Reverse Path

Sample output for a dealiasing run with 1000 pairs is shown below.

--------------------------------------------------------------------------------

Total candidate pairs: 1000
Total interfaces tested for suitability: 2000

Suitability Stats:
Probing for (D|DXXX) and (D|DDDD)
Classification	# IPs	% of IPs
======|FAILURE CONDITIONS|======
Unresponsive	791	39.55%
Inconsistent	327	16.35%
Extra Stamp	7	0.35%
Zero Stamps	277	13.85%
One Stamp	286	14.30%
=======|PASS CONDITIONS|========
Two Stamps	156	7.80%
Three Stamps	0	0.00%
Four Stamps	156	7.80%
--------------------------------
TOTAL		2000	100%
================================
Number of pairs which passed suitability check: 73


Probe Response Stats:
Resp/Atmpt	Frequency
------------------------
0/5		779	*
1/5		12	* both included in 'Unresponsive' count above
2/5		9
3/5		16
4/5		22
5/5		1162

Alias Validity Check Stats:
Probing (A|ABAB) for each IP
Classification	# IPs	% of IPs
======|FAILURE CONDITIONS|======
Unresponsive	0	0.00%
Inconsistent	0	0.00%
No Stamp	0	0.00%
One Stamp	12	8.22%
RP TS Decrease	0	0.00%
RP TS Gap	0	0.00%
RP TS Unknown	0	0.00%
=======|PASS CONDITIONS|========
Two Stamp	6	4.11%
Three Stamp	0	0.00%
Four Stamp	128	87.67%
--------------------------------
TOTAL		146	100%
================================
Number of pairs which passed validity check: 67



===STATS BELOW HERE ARE FOR PAIRS===


Return Path Check Stats:
Probing (A|BABA)
Classification	# Pairs	% of Pairs
======|FAILURE CONDITIONS|======
Unresponsive	0	0.00%
Inconsistent	0	0.00%
2 Stamp (Dec)	0	0.00%
2 Stamp (Gap)	0	0.00%
2 Stamp (Unk)	0	0.00%
3 Stamp (Dec)	0	0.00%
3 Stamp (Gap)	0	0.00%
3 Stamp (Unk)	0	0.00%
4 Stamp (ERR)	0	0.00%
=======|PASS CONDITIONS|========
No Stamp	0	0.00%
1 Stamp		0	0.00%
--------------------------------
TOTAL		0	0%
================================


Alias Check Stats:
Probing (A|ABAB) and (B|BABA)
Classification	# Pairs	% of Pairs
======|FAILURE CONDITIONS|======
<5 Replies	0	0.00%
Three Stamps	0	0.00%
=======|PASS CONDITIONS|========
Two Stamps	3	4.48%
Four Stamps	64	95.52%
--------------------------------
TOTAL		67	100%
================================

Shared Clock Check Stats:
Timestamps from (A|ABAB) and (B|BABA)
Classification	# Pairs	% of Pairs
======|FAILURE CONDITIONS|======
Decreasing TS	0	0.00%
TS Variance	0	0.00%
=======|PASS CONDITIONS|========
Shared Clock	3	100.00%
Midnight/Epoch	0	0.00%
--------------------------------
TOTAL		3	100%
================================

Distance/Loop Check Stats:
Classification	# Pairs	% of Pairs
======|FAILURE CONDITIONS|======
Unresponsive	0	0.00%
TTL Variance	0	0.00%
Distance	1	33.33%
=======|PASS CONDITIONS|========
Distance	2	66.67%
--------------------------------
TOTAL		3	100%
================================

Overall Verdicts:
Classification		# Pairs	% of Pairs
=========|FAILURE CONDITIONS|=========
Non-Alias Strong	0	0.00%
Non-Alias Weak		0	0.00%
Ineligible		914	91.40%
Unknown			7	0.70%
Unknown Reprobe		13	1.30%
Unknown Alias		0	0.00%
Unknown Non-Alias	0	0.00%
Error			0	0.00%
==========|PASS CONDITIONS|===========
Alias			64	6.40%
Alias Weak		2	0.20%
Alias Strong		0	0.00%
--------------------------------------
TOTAL			1000	100%
======================================


--------------------------------------------------------------------------------
If the script is called with the --histogram option, it will display three
additional histograms which can be useful for determining the causes of various
results.

Pairs which contain one pass interface and one fail interface:
P2S		150	90.36%
	F1S	90	54.22%
	FNS	35	21.08%
	FNR	17	10.24%
	FVS	8	4.82%

P4S		16	9.64%
	FNR	13	7.83%
	FNS	2	1.20%
	FVS	1	0.60%

-- Shows the type of address that a passing address was paired with which caused
   the pair to be rejected after suitability testing. In this case, the majority
   of pairs for which one address was suitable but not the other are two
   stampers being paired with one a one stamper.


Pairings which pass suitability check:
P2S		3	4.11%
	P2S	3	4.11%

P4S		70	95.89%
	P4S	70	95.89%

-- Similar to the above table, but provides an indication of what an address is
   usually paired with when they passed the suitability check. In this case we
   never see a four stamper paired with a two stamper passing suitability
   checking.


Mapping from Suitability result to AVC result:
Suit A	AVC A	Suit B	AVC B	Count	%
P2S				6	4.11%
	P2S			6	100.00%
		P2S		6	100.00%
			P2S	6	100.00%

P4S				140	95.89%
	P4S			128	91.43%
		P4S		128	100.00%
			P4S	128	100.00%
	F1S			12	8.57%
		P4S		12	100.00%
			F1S	12	100.00%


-- Shows the relationship between the stamping behavior for (A|AAAA), (A|ABAB),
   (B|BBBB) and (B|BABA). That is, an address which stamps four times in
   suitability checking (A|AAAA), almost always stamps four times in the
   validity check (A|ABAB), and when it does, the address that it is paired with
   always stamps four times for both the suitability and validity checks.

Note that these histograms ignore the ordering of the addresses, so a pair (X,Y)
can appear as X -> Y as well as Y -> X. I.e. X can be both A and B in these
histograms. 
